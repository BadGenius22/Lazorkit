# ğŸ—ï¸ LazorKit SDK Integration - Technical Architecture

<div align="center">

**A practical code example demonstrating LazorKit SDK integration for developers to get started fast.**

</div>

---

## ğŸ“‘ Table of Contents

- [System Overview](#-system-overview)
- [Architecture Decision Records](#-architecture-decision-records)
- [Data Flow Diagrams](#-data-flow-diagrams)
- [Component Architecture](#-component-architecture)
- [Payment Widget Architecture](#-payment-widget-architecture)
- [State Management](#-state-management)
- [Security Model](#-security-model)
- [API Reference](#-api-reference)
- [Error Handling Strategy](#-error-handling-strategy)
- [Performance Considerations](#-performance-considerations)
- [Edge Cases & Failure Modes](#-edge-cases--failure-modes)
- [Dependencies](#-dependencies)
- [Compliance & Data Privacy](#-compliance--data-privacy)

---

## ğŸŒ System Overview

### High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ğŸ–¥ï¸ USER DEVICE                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  ğŸ” Secure       â”‚    â”‚  ğŸŒ Browser/App  â”‚    â”‚  ğŸ”‘ WebAuthn API â”‚        â”‚
â”‚  â”‚     Enclave      â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â—„â”€â”€â–ºâ”‚  â”‚ Next.js    â”‚  â”‚â—„â”€â”€â–ºâ”‚  â”‚ Credential â”‚  â”‚        â”‚
â”‚  â”‚  â”‚ Private Keyâ”‚  â”‚    â”‚  â”‚ Frontend   â”‚  â”‚    â”‚  â”‚ Manager    â”‚  â”‚        â”‚
â”‚  â”‚  â”‚ (P-256)    â”‚  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  React Context   â”‚    â”‚  navigator.      â”‚        â”‚
â”‚  â”‚  FaceID/TouchID  â”‚    â”‚  State Mgmt      â”‚    â”‚  credentials     â”‚        â”‚
â”‚  â”‚  Windows Hello   â”‚    â”‚                  â”‚    â”‚                  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ HTTPS
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       â˜ï¸ LAZORKIT INFRASTRUCTURE                              â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  ğŸ” Portal       â”‚    â”‚  â›½ Paymaster    â”‚    â”‚  ğŸŒ RPC Gateway  â”‚        â”‚
â”‚  â”‚     Service      â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”‚ Fee        â”‚  â”‚    â”‚  â”‚ Load       â”‚  â”‚        â”‚
â”‚  â”‚  â”‚ Passkey    â”‚  â”‚    â”‚  â”‚ Sponsor    â”‚  â”‚    â”‚  â”‚ Balancer   â”‚  â”‚        â”‚
â”‚  â”‚  â”‚ Registry   â”‚  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”‚ Token      â”‚  â”‚    â”‚  â”‚ Rate       â”‚  â”‚        â”‚
â”‚  â”‚  â”‚ Session    â”‚  â”‚    â”‚  â”‚ Validator  â”‚  â”‚    â”‚  â”‚ Limiter    â”‚  â”‚        â”‚
â”‚  â”‚  â”‚ Manager    â”‚  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                        â”‚                        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           â›“ï¸ SOLANA DEVNET                                    â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  ğŸ“œ LazorKit     â”‚    â”‚  ğŸ’° Smart Wallet â”‚    â”‚  ğŸ”§ System       â”‚        â”‚
â”‚  â”‚     Program      â”‚    â”‚     (PDA)        â”‚    â”‚     Program      â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚
â”‚  â”‚  â”‚ Verify     â”‚  â”‚â”€â”€â”€â–ºâ”‚  â”‚ User       â”‚  â”‚â”€â”€â”€â–ºâ”‚  â”‚ Transfer   â”‚  â”‚        â”‚
â”‚  â”‚  â”‚ Passkey    â”‚  â”‚    â”‚  â”‚ Funds      â”‚  â”‚    â”‚  â”‚ SOL        â”‚  â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚                  â”‚        â”‚
â”‚  â”‚  â”‚ Derive     â”‚  â”‚    â”‚  â”‚ Access     â”‚  â”‚    â”‚                  â”‚        â”‚
â”‚  â”‚  â”‚ PDA        â”‚  â”‚    â”‚  â”‚ Control    â”‚  â”‚    â”‚                  â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚                  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Š Architecture Layers

| Layer | Components | Responsibility |
|-------|------------|----------------|
| ğŸ¨ **Presentation** | Next.js Pages, React Components | UI rendering, user interaction |
| âš™ï¸ **Application** | Hooks, Context, State Management | Business logic, state coordination |
| ğŸ”Œ **Integration** | LazorKit SDK, Web3.js | External service communication |
| ğŸ” **Security** | WebAuthn, Secure Enclave | Authentication, key management |
| â˜ï¸ **Infrastructure** | Portal, Paymaster, RPC | Backend services |
| â›“ï¸ **Blockchain** | Solana Programs, PDAs | On-chain state and execution |

---

## ğŸ“‹ Architecture Decision Records

### ADR-001: Next.js App Router over Pages Router

| Attribute | Value |
|-----------|-------|
| **Status** | âœ… Accepted |
| **Context** | Need to choose between Next.js Pages Router and App Router |
| **Decision** | Use App Router (`app/` directory) |
| **Rationale** | â€¢ App Router is recommended for new Next.js projects<br>â€¢ Better support for React Server Components<br>â€¢ Improved data fetching patterns<br>â€¢ Future-proof architecture |
| **Consequences** | âœ… Modern patterns, better DX<br>âš ï¸ Requires "use client" directives |

### ADR-002: React Context over External State Management

| Attribute | Value |
|-----------|-------|
| **Status** | âœ… Accepted |
| **Context** | Need state management for wallet connection state |
| **Decision** | Use LazorkitProvider's built-in React Context |
| **Rationale** | â€¢ SDK provides context out-of-box<br>â€¢ Demo scope is small<br>â€¢ Avoids unnecessary complexity |
| **Consequences** | âœ… Simpler architecture<br>âœ… Fewer dependencies |

### ADR-003: Tailwind CSS for Styling

| Attribute | Value |
|-----------|-------|
| **Status** | âœ… Accepted |
| **Context** | Need styling solution for UI components |
| **Decision** | Use Tailwind CSS utility classes |
| **Rationale** | â€¢ Rapid prototyping<br>â€¢ Built-in with create-next-app<br>â€¢ Excellent tree-shaking |
| **Consequences** | âœ… Fast development<br>âœ… Small CSS bundle |

### ADR-004: Client-Side Only for Wallet Operations

| Attribute | Value |
|-----------|-------|
| **Status** | âœ… Accepted |
| **Context** | WebAuthn requires browser APIs |
| **Decision** | Mark wallet components as client-side ("use client") |
| **Rationale** | â€¢ WebAuthn only works in browser<br>â€¢ Cannot SSR authentication flows |
| **Consequences** | âœ… Works correctly with browser APIs |

---

## ğŸ”„ Data Flow Diagrams

### 1ï¸âƒ£ Passkey Creation Flow (New User)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¤     â”‚     â”‚  ğŸŒ     â”‚     â”‚  ğŸ”     â”‚     â”‚  â˜ï¸     â”‚     â”‚  â›“ï¸     â”‚
â”‚  User   â”‚     â”‚ Browser â”‚     â”‚ Secure  â”‚     â”‚ Portal  â”‚     â”‚ Solana  â”‚
â”‚         â”‚     â”‚  (App)  â”‚     â”‚ Enclave â”‚     â”‚ Service â”‚     â”‚ Devnet  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚ 1. Click      â”‚               â”‚               â”‚               â”‚
     â”‚ "Connect"     â”‚               â”‚               â”‚               â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚ 2. Call       â”‚               â”‚               â”‚
     â”‚               â”‚ navigator.    â”‚               â”‚               â”‚
     â”‚               â”‚ credentials.  â”‚               â”‚               â”‚
     â”‚               â”‚ create()      â”‚               â”‚               â”‚
     â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚ 3. Biometric  â”‚               â”‚               â”‚               â”‚
     â”‚ Prompt ğŸ‘†     â”‚               â”‚               â”‚               â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚ 4. Authorize  â”‚               â”‚               â”‚               â”‚
     â”‚ (FaceID/      â”‚               â”‚               â”‚               â”‚
     â”‚  TouchID)     â”‚               â”‚               â”‚               â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚ 5. Generate   â”‚               â”‚               â”‚
     â”‚               â”‚ P-256 keypair â”‚               â”‚               â”‚
     â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚ 6. Register   â”‚               â”‚               â”‚
     â”‚               â”‚ passkey       â”‚               â”‚               â”‚
     â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚ 7. Derive PDA â”‚
     â”‚               â”‚               â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚               â”‚               â”‚               â”‚ 8. PDA Addressâ”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
     â”‚               â”‚ 9. Return wallet + session    â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚               â”‚               â”‚
     â”‚ 10. Connected â”‚               â”‚               â”‚               â”‚
     â”‚ âœ…            â”‚               â”‚               â”‚               â”‚
```

### 2ï¸âƒ£ Gasless Transaction Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¤     â”‚     â”‚  ğŸ“±     â”‚     â”‚  ğŸ”     â”‚     â”‚  â›½     â”‚     â”‚  â›“ï¸     â”‚
â”‚  User   â”‚     â”‚  App    â”‚     â”‚ Secure  â”‚     â”‚Paymasterâ”‚     â”‚ Solana  â”‚
â”‚         â”‚     â”‚         â”‚     â”‚ Enclave â”‚     â”‚         â”‚     â”‚ Devnet  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚ 1. Enter      â”‚               â”‚               â”‚               â”‚
     â”‚ recipient     â”‚               â”‚               â”‚               â”‚
     â”‚ + amount      â”‚               â”‚               â”‚               â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚ 2. Build      â”‚               â”‚               â”‚
     â”‚               â”‚ transfer      â”‚               â”‚               â”‚
     â”‚               â”‚ instruction   â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚ 3. Request    â”‚               â”‚               â”‚
     â”‚               â”‚ fee wrapping  â”‚               â”‚               â”‚
     â”‚               â”‚ (feeToken:    â”‚               â”‚               â”‚
     â”‚               â”‚  USDC)        â”‚               â”‚               â”‚
     â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
     â”‚               â”‚ 4. Wrapped tx â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚ 5. Biometric  â”‚               â”‚               â”‚               â”‚
     â”‚ prompt ğŸ‘†     â”‚               â”‚               â”‚               â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚ 6. Authorize  â”‚               â”‚               â”‚               â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚ 7. Sign tx    â”‚               â”‚               â”‚
     â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚ 8. Submit     â”‚               â”‚               â”‚
     â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚ 9. Relay      â”‚
     â”‚               â”‚               â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚               â”‚               â”‚               â”‚ 10. Confirmed â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
     â”‚               â”‚ 11. Signature â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚               â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚               â”‚               â”‚
     â”‚ 12. Success âœ…â”‚               â”‚               â”‚               â”‚
```

---

## ğŸ§© Component Architecture

### Component Hierarchy

```
ğŸ“„ app/layout.tsx
â””â”€â”€ ğŸ” LazorkitProvider (Context Provider)
    â”œâ”€â”€ <head> metadata
    â””â”€â”€ <body>
        â””â”€â”€ BufferPolyfill (Client-side)
            â”œâ”€â”€ ğŸ§­ Navbar
            â”‚   â”œâ”€â”€ Logo/Brand
            â”‚   â”œâ”€â”€ NavLinks
            â”‚   â”‚   â”œâ”€â”€ ğŸ  Link: Home (/)
            â”‚   â”‚   â”œâ”€â”€ ğŸ” Link: Passkey Login (/passkey-login)
            â”‚   â”‚   â”œâ”€â”€ ğŸ’¸ Link: Gasless Transfer (/gasless-transfer)
            â”‚   â”‚   â””â”€â”€ ğŸ›’ Link: Payment Widget (/payment-widget)
            â”‚   â””â”€â”€ ğŸ”˜ ConnectButton
            â”‚       â”œâ”€â”€ State: Disconnected â†’ "Connect Wallet"
            â”‚       â”œâ”€â”€ State: Connecting â†’ "Connecting..." (disabled)
            â”‚       â””â”€â”€ State: Connected â†’ "Disconnect (0x...)"
            â””â”€â”€ {children} (Page Content)
                â”‚
                â”œâ”€â”€ ğŸ  app/page.tsx (Homepage)
                â”‚   â”œâ”€â”€ HeroSection
                â”‚   â”œâ”€â”€ FeatureCards
                â”‚   â””â”€â”€ InfoSection
                â”‚
                â”œâ”€â”€ ğŸ” app/passkey-login/page.tsx
                â”‚   â”œâ”€â”€ PageHeader
                â”‚   â”œâ”€â”€ InstructionsPanel
                â”‚   â”œâ”€â”€ ConnectButton (if disconnected)
                â”‚   â””â”€â”€ ğŸ’° WalletInfo (if connected)
                â”‚       â”œâ”€â”€ AddressDisplay
                â”‚       â”œâ”€â”€ CopyButton
                â”‚       â”œâ”€â”€ ExplorerLink
                â”‚       â””â”€â”€ BalanceDisplay
                â”‚
                â”œâ”€â”€ ğŸ’¸ app/gasless-transfer/page.tsx
                â”‚   â”œâ”€â”€ PageHeader
                â”‚   â”œâ”€â”€ ConnectionGuard (requires wallet)
                â”‚   â”‚   â”œâ”€â”€ WalletInfo
                â”‚   â”‚   â””â”€â”€ ğŸ“ TransferForm
                â”‚   â”‚       â”œâ”€â”€ RecipientInput
                â”‚   â”‚       â”œâ”€â”€ AmountInput
                â”‚   â”‚       â”œâ”€â”€ FeeTokenSelector (SOL/USDC)
                â”‚   â”‚       â”œâ”€â”€ SubmitButton
                â”‚   â”‚       â””â”€â”€ ResultDisplay
                â”‚   â””â”€â”€ NotConnectedPrompt (if disconnected)
                â”‚
                â””â”€â”€ ğŸ›’ app/payment-widget/page.tsx
                    â”œâ”€â”€ PageHeader
                    â”œâ”€â”€ DemoSection
                    â”‚   â”œâ”€â”€ ğŸ’³ PaymentWidget (Live Demo)
                    â”‚   â””â”€â”€ ConfigPanel
                    â”œâ”€â”€ IntegrationGuide
                    â””â”€â”€ UseCasesSection
```

### Component Specifications

#### ğŸ” LazorkitProvider

```typescript
interface LazorkitProviderProps {
  children: React.ReactNode;
  rpcUrl: string;              // Solana RPC endpoint
  portalUrl: string;           // LazorKit portal service
  paymasterConfig: {
    paymasterUrl: string;      // Fee sponsorship service
  };
}

// Context value provided to children
interface LazorkitContextValue {
  wallet: WalletAccount | null;
  isConnected: boolean;
  isConnecting: boolean;
  smartWalletPubkey: PublicKey | null;
  connect: () => Promise<void>;
  disconnect: () => Promise<void>;
  signAndSendTransaction: (params: TransactionParams) => Promise<string>;
}
```

#### ğŸ”˜ ConnectButton

```typescript
interface ConnectButtonProps {
  className?: string;
  variant?: 'default' | 'compact';
}

// State machine
type ButtonState =
  | { status: 'disconnected' }  // â†’ "Connect Wallet"
  | { status: 'connecting' }    // â†’ "Connecting..." (disabled)
  | { status: 'connected'; address: string }; // â†’ "Disconnect (0x...)"
```

#### ğŸ“ TransferForm

```typescript
interface TransferFormProps {
  onSuccess?: (signature: string) => void;
  onError?: (error: Error) => void;
}

interface FormState {
  recipient: string;           // Solana address (base58)
  amount: string;              // SOL amount as string
  feeToken: 'SOL' | 'USDC';    // Fee payment method
  isSubmitting: boolean;
  result: TransferResult | null;
  error: string | null;
}
```

---

## ğŸ’³ Payment Widget Architecture

### Overview

The Payment Widget is a production-ready, embeddable component for merchants to accept SOL payments with passkey authentication.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ’³ PAYMENT WIDGET SYSTEM ARCHITECTURE                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   ğŸª MERCHANT INTEGRATION                       ğŸ” LAZORKIT + SOLANA        â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚  Merchant Website   â”‚                      â”‚  LazorKit Provider  â”‚      â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                      â”‚  (Wallet Context)   â”‚      â”‚
â”‚   â”‚  â”‚ PaymentWidget â”‚  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚      â”‚
â”‚   â”‚  â”‚               â”‚  â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚   â”‚  â”‚ â€¢ Amount      â”‚  â”‚                                 â”‚                 â”‚
â”‚   â”‚  â”‚ â€¢ Pay Button  â”‚  â”‚                                 â–¼                 â”‚
â”‚   â”‚  â”‚ â€¢ Status      â”‚  â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                      â”‚     â›½ Paymaster    â”‚      â”‚
â”‚   â”‚                     â”‚                      â”‚  (Fee Sponsorship)  â”‚      â”‚
â”‚   â”‚  Callbacks:         â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚   â”‚  â€¢ onSuccess() âœ…   â”‚                                 â”‚                 â”‚
â”‚   â”‚  â€¢ onError() âŒ     â”‚                                 â–¼                 â”‚
â”‚   â”‚  â€¢ onCancel() ğŸš«    â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚   â›“ï¸ Solana Network â”‚      â”‚
â”‚                                                â”‚  (Transaction)      â”‚      â”‚
â”‚                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PaymentWidget Props

```typescript
interface PaymentWidgetProps {
  // Required
  merchantAddress: string;          // Recipient wallet address

  // Amount Configuration
  amount?: number;                  // Fixed amount
  allowCustomAmount?: boolean;      // Allow user to modify

  // Merchant Branding
  merchantName?: string;            // Display name
  merchantLogo?: string;            // Logo URL
  description?: string;             // Payment description
  reference?: string;               // Order/invoice reference

  // Feature Toggles
  enableGasless?: boolean;          // Allow gasless payments (default: true)

  // Callbacks
  onPaymentStart?: () => void;
  onPaymentSuccess?: (result: PaymentResult) => void;
  onPaymentError?: (error: PaymentError) => void;
  onPaymentCancel?: () => void;

  // Styling
  className?: string;
}

interface PaymentResult {
  signature: string;                // Transaction signature
  explorerUrl: string;              // Solscan link
  amount: number;                   // Amount paid
  currency: 'SOL' | 'USDC';         // Currency used
  reference?: string;               // Order reference
  timestamp: number;                // Unix timestamp
}
```

### State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ğŸ’³ PAYMENT WIDGET STATE MACHINE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚                              â”‚  â¸ï¸ IDLE â”‚                                   â”‚
â”‚                              â”‚          â”‚                                   â”‚
â”‚                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                   â”‚                                         â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚              â”‚                    â”‚                    â”‚                    â”‚
â”‚              â–¼                    â–¼                    â–¼                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚     â”‚ ğŸ“ AWAITING    â”‚   â”‚  ğŸ”„ CONNECT  â”‚   â”‚  (other states) â”‚            â”‚
â”‚     â”‚    INPUT       â”‚   â”‚    ING       â”‚   â”‚                 â”‚            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚             â”‚                   â”‚                                           â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚
â”‚                                 â”‚                                           â”‚
â”‚                                 â–¼                                           â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                        â”‚ â³ PROCESS  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚                        â”‚    ING      â”‚                     â”‚              â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚              â”‚
â”‚                               â”‚                             â”‚              â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚              â”‚
â”‚              â”‚                â”‚                â”‚            â”‚              â”‚
â”‚              â–¼                â–¼                â–¼            â”‚              â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚              â”‚
â”‚     â”‚   âœ… SUCCESS   â”‚ â”‚   âŒ ERROR â”‚ â”‚ ğŸš« CANCEL  â”‚       â”‚              â”‚
â”‚     â”‚                â”‚ â”‚            â”‚ â”‚            â”‚       â”‚              â”‚
â”‚     â”‚ â€¢ Signature    â”‚ â”‚ â€¢ Message  â”‚ â”‚ â€¢ Reset    â”‚       â”‚              â”‚
â”‚     â”‚ â€¢ Explorer URL â”‚ â”‚ â€¢ Retry?   â”‚ â”‚            â”‚       â”‚              â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚              â”‚
â”‚                              â”‚                              â”‚              â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                    (if recoverable)                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Use Cases

| Use Case | Configuration | Example |
|----------|---------------|---------|
| ğŸ›’ **E-commerce** | Fixed amount | `amount={29.99}` |
| ğŸ’° **Donations** | Custom amount | `allowCustomAmount` |
| ğŸª **Point of Sale** | Fixed amount | `amount={5.00}` |
| ğŸ® **In-App Purchase** | Fixed, immediate | `amount={0.99}` |

---

## ğŸ—ƒï¸ State Management

### Global State (LazorkitProvider Context)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ” LazorkitProvider Context                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Connection State                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ isConnecting    â”‚  â”‚ Source: connect() async         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ boolean         â”‚  â”‚ Transitions: false â†’ true â†’     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚              false              â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ isConnected     â”‚  â”‚ Source: wallet !== null         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ boolean         â”‚  â”‚ Derived state                   â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     Wallet State                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ wallet          â”‚  â”‚ Type: WalletAccount | null      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚ Contains: credential, session   â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ smartWalletPub  â”‚  â”‚ Type: PublicKey | null          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ key             â”‚  â”‚ Derived: PDA from passkey       â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     Actions                                â”‚  â”‚
â”‚  â”‚  ğŸ” connect()              â†’ Initiates passkey flow       â”‚  â”‚
â”‚  â”‚  ğŸšª disconnect()           â†’ Clears session               â”‚  â”‚
â”‚  â”‚  âœï¸ signAndSendTransaction â†’ Signs + submits tx           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security Model

### Trust Boundaries

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”’ TRUST BOUNDARY 1: Device Hardware                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Secure Enclave / TPM                                                â”‚ â”‚
â”‚ â”‚ â€¢ P-256 private key (NEVER leaves enclave)                          â”‚ â”‚
â”‚ â”‚ â€¢ Biometric templates (FaceID/TouchID)                              â”‚ â”‚
â”‚ â”‚ â€¢ Hardware-backed key attestation                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ TRUST BOUNDARY 2: Browser Sandbox                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ WebAuthn API                                                        â”‚ â”‚
â”‚ â”‚ â€¢ Credential ID (public)                                            â”‚ â”‚
â”‚ â”‚ â€¢ Public key (can be exported)                                      â”‚ â”‚
â”‚ â”‚ â€¢ Origin binding (phishing protection)                              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ TRUST BOUNDARY 3: Network                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ”’ Encrypted (HTTPS)          â”‚ â”‚ ğŸ“¡ Exposed to Network             â”‚ â”‚
â”‚ â”‚ â€¢ API requests to Portal      â”‚ â”‚ â€¢ Public key                      â”‚ â”‚
â”‚ â”‚ â€¢ API requests to Paymaster   â”‚ â”‚ â€¢ Signed transactions             â”‚ â”‚
â”‚ â”‚ â€¢ Transaction submissions     â”‚ â”‚ â€¢ Wallet addresses                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Security Properties

| Property | Implementation | Guarantee |
|----------|----------------|-----------|
| ğŸ”‘ **Key Security** | Secure Enclave P-256 | Private key never exposed to JavaScript |
| ğŸ£ **Phishing Resistance** | WebAuthn origin binding | Credentials only work on registered domain |
| ğŸ”„ **Replay Protection** | Challenge-response | Each signature unique per transaction |
| âœï¸ **Transaction Integrity** | ECDSA signatures | Tamper-evident, non-repudiable |
| ğŸš« **No Seed Phrase** | Hardware-bound keys | Nothing to phish, leak, or lose |

### Threat Mitigation

| Threat | Mitigation |
|--------|------------|
| ğŸ”“ Private key theft | Key never leaves Secure Enclave |
| ğŸ£ Phishing attacks | WebAuthn origin binding + biometric required |
| ğŸ‘¤ Man-in-the-middle | HTTPS + challenge-response protocol |
| ğŸ“ Transaction tampering | User signs exact transaction data |
| ğŸ´â€â˜ ï¸ Session hijacking | Short-lived tokens + device binding |

---

## ğŸ“¡ API Reference

### External Services

| Service | Base URL | Purpose |
|---------|----------|---------|
| â›“ï¸ **Solana RPC** | `https://api.devnet.solana.com` | Blockchain queries |
| ğŸ” **LazorKit Portal** | `https://portal.lazor.sh` | Passkey management |
| â›½ **Paymaster** | `https://kora.devnet.lazorkit.com` | Fee sponsorship |
| ğŸ” **Solscan** | `https://solscan.io` | Transaction viewing |

### SDK Methods

```typescript
// ğŸ” useWallet() Hook
function useWallet(): {
  // State
  wallet: WalletAccount | null;
  isConnected: boolean;
  isConnecting: boolean;
  smartWalletPubkey: PublicKey | null;

  // Actions
  connect: () => Promise<void>;           // ğŸ” Trigger passkey flow
  disconnect: () => Promise<void>;        // ğŸšª Clear session
  signAndSendTransaction: (params) => Promise<string>; // âœï¸ Sign & send
}

// Transaction Parameters
interface TransactionParams {
  instructions: TransactionInstruction[];
  transactionOptions?: {
    feeToken?: 'SOL' | 'USDC';  // â›½ Fee payment method
  };
}
```

---

## âš ï¸ Error Handling Strategy

### Error Classification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            âš ï¸ ERROR TAXONOMY                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ”„ RECOVERABLE ERRORS (User can retry)                                  â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ NetworkError        â”‚ â†’ Show retry button, check connection             â”‚â”‚
â”‚  â”‚ TransactionFailed   â”‚ â†’ Show specific error, suggest fix                â”‚â”‚
â”‚  â”‚ PaymasterError      â”‚ â†’ Suggest using SOL for fees instead              â”‚â”‚
â”‚  â”‚ RPCError            â”‚ â†’ Retry with exponential backoff                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸš« USER-INITIATED CANCELLATION (Silent handling)                        â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ UserCancelled       â”‚ â†’ Reset UI state, no error shown                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ âŒ BLOCKING ERRORS (Requires different approach)                        â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ PasskeyNotSupported â”‚ â†’ Show compatibility message                      â”‚â”‚
â”‚  â”‚ SessionExpired      â”‚ â†’ Prompt reconnection                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Implementation Pattern

```typescript
async function handleTransfer() {
  try {
    setIsSubmitting(true);
    const signature = await signAndSendTransaction({...});
    setResult({ signature });
  } catch (err) {
    if (err.name === 'UserCancelled') {
      return; // ğŸš« Silent - user cancelled
    }
    if (err.message?.includes('insufficient')) {
      setError('ğŸ’° Insufficient balance');
    } else if (err.message?.includes('paymaster')) {
      setError('â›½ Fee sponsorship unavailable');
    } else {
      setError(`âŒ Transaction failed: ${err.message}`);
    }
  } finally {
    setIsSubmitting(false);
  }
}
```

---

## âš¡ Performance Considerations

### Critical Path Analysis

```
ğŸ‘† User clicks "Transfer" â†’ âœ… Signature returned

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš¡ CRITICAL PATH (Target: < 5 seconds total)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚ 1. Build instruction          ~10ms   â”‚ ğŸ’» Local computation               â”‚
â”‚ 2. Paymaster wrapping        ~200ms   â”‚ ğŸŒ Network (LazorKit)              â”‚
â”‚ 3. Biometric prompt        ~1-3000ms  â”‚ ğŸ‘† User interaction (variable)     â”‚
â”‚ 4. Sign in Secure Enclave     ~50ms   â”‚ ğŸ” Hardware operation              â”‚
â”‚ 5. Submit to Paymaster       ~100ms   â”‚ ğŸŒ Network (LazorKit)              â”‚
â”‚ 6. Relay to Solana           ~200ms   â”‚ â›“ï¸ Network (Solana RPC)            â”‚
â”‚ 7. Confirmation polling      ~400ms   â”‚ â›“ï¸ Network (Solana RPC)            â”‚
â”‚                                                                             â”‚
â”‚ â±ï¸ Total (excl. biometric): ~960ms                                         â”‚
â”‚ â±ï¸ Total (incl. biometric): ~2-4 seconds                                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”€ Edge Cases & Failure Modes

| Scenario | Expected Behavior | Implementation |
|----------|-------------------|----------------|
| ğŸš« No biometric hardware | Show unsupported message | Check `PublicKeyCredential` API |
| ğŸ‘† User cancels biometric | Silent reset | Catch `UserCancelled` error |
| â° Session expired mid-tx | Re-prompt authentication | Detect 401, call `connect()` |
| ğŸ’° Zero balance transfer | Allow (valid on Solana) | No minimum validation |
| âŒ Invalid address paste | Disable submit, show error | Real-time validation |
| â›½ Paymaster down | Fallback to SOL fees | Try/catch with suggestion |
| ğŸ”„ Page refresh mid-tx | Tx may complete | Check tx status on load |

---

## ğŸ“¦ Dependencies

### Package Dependencies

```
ğŸ“¦ package.json
â”œâ”€â”€ ğŸ­ Production Dependencies
â”‚   â”œâ”€â”€ @lazorkit/wallet        # ğŸ” Core SDK for passkey wallets
â”‚   â”œâ”€â”€ @coral-xyz/anchor       # âš“ Solana framework
â”‚   â”œâ”€â”€ @solana/web3.js         # â›“ï¸ Solana JavaScript SDK
â”‚   â”œâ”€â”€ buffer                  # ğŸ”§ Node.js Buffer polyfill
â”‚   â”œâ”€â”€ next                    # âš›ï¸ React framework
â”‚   â”œâ”€â”€ react                   # âš›ï¸ UI library
â”‚   â””â”€â”€ react-dom               # âš›ï¸ React DOM bindings
â”‚
â””â”€â”€ ğŸ”§ Development Dependencies
    â”œâ”€â”€ typescript              # ğŸ“˜ Type safety
    â”œâ”€â”€ tailwindcss             # ğŸ¨ Utility CSS
    â”œâ”€â”€ eslint                  # ğŸ” Code linting
    â””â”€â”€ @types/*                # ğŸ“˜ TypeScript definitions
```

### Browser Compatibility

| Feature | Chrome | Firefox | Safari | Edge |
|---------|--------|---------|--------|------|
| ğŸ” WebAuthn | 67+ | 60+ | 13+ | 18+ |
| ğŸ”‘ Passkeys | 108+ | 122+ | 16+ | 108+ |
| ğŸ”’ Secure Enclave | âœ… | âœ… | âœ… | âœ… |

---

## ğŸ” Compliance & Data Privacy

### Data Handling

| Data Type | Storage Location | Retention |
|-----------|------------------|-----------|
| ğŸ” **Private Key** | Secure Enclave (device) | Permanent (never leaves) |
| ğŸ”‘ **Public Key** | Portal Service | Session |
| ğŸ« **Session Token** | Memory + localStorage | Session |
| ğŸ’° **Wallet Address** | Blockchain (public) | Permanent |
| ğŸ“ **Transaction Data** | Blockchain (public) | Permanent |

### Privacy Principles

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ğŸ” PRIVACY BY DESIGN                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  1ï¸âƒ£ DATA MINIMIZATION                                                       â”‚
â”‚     â€¢ Only collect what's necessary for functionality                       â”‚
â”‚     â€¢ No tracking pixels, analytics cookies, or fingerprinting              â”‚
â”‚     â€¢ Wallet address is pseudonymous                                        â”‚
â”‚                                                                              â”‚
â”‚  2ï¸âƒ£ USER CONTROL                                                            â”‚
â”‚     â€¢ User initiates all actions                                            â”‚
â”‚     â€¢ Clear disconnect removes local session data                           â”‚
â”‚     â€¢ No background data collection                                         â”‚
â”‚                                                                              â”‚
â”‚  3ï¸âƒ£ TRANSPARENCY                                                            â”‚
â”‚     â€¢ All transactions visible on public blockchain                         â”‚
â”‚     â€¢ No hidden data flows                                                  â”‚
â”‚     â€¢ Open source code (auditable)                                          â”‚
â”‚                                                                              â”‚
â”‚  4ï¸âƒ£ SECURITY                                                                â”‚
â”‚     â€¢ Private keys never transmitted                                        â”‚
â”‚     â€¢ HTTPS for all communications                                          â”‚
â”‚     â€¢ Hardware-backed key storage                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Revision History

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | Initial | Base architecture |
| 1.1 | Enhanced | Added sequence diagrams, security model |
| 1.2 | Industry Standard | Added ADR, observability, scalability |
| 2.0 | 2025-01-09 | Added Payment Widget Architecture |
| 2.1 | 2025-01-09 | Visual improvements, emojis, removed QR code feature |

---

<div align="center">

**Built with â¤ï¸ by [Dewangga Praxindo](https://x.com/dewaxindo)**

</div>
